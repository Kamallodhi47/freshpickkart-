<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<%
    boolean isLoggedIn = (session.getAttribute("user") != null);
%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FreshPickKart</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
}

/* NAVBAR */
.navbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    background: #2ecc71;
}

.nav-left, .nav-right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.nav-btn {
    background: transparent;
    border: none;
    color: #fff;
    font-size: 15px;
    cursor: pointer;
}

.nav-btn i {
    margin-right: 6px;
}

/* DROPDOWN */
.dropdown-menu {
    display: none;
    position: absolute;
    top: 55px;
    background: #fff;
    border-radius: 8px;
    min-width: 180px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1100;
}

.dropdown-menu a {
    display: block;
    padding: 10px 14px;
    text-decoration: none;
    color: #333;
}

.dropdown-menu a:hover {
    background: #f1f1f1;
}

/* OVERLAY */
.dropdown-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 900;
}

/* LOGIN POPUP */
#loginPopup {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 9999;
}

#loginPopup .popup-box {
    background: #fff;
    width: 320px;
    margin: 150px auto;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
}
</style>
</head>

<body>

<!-- OVERLAY -->
<div class="dropdown-overlay" id="overlay" onclick="closeAll()"></div>

<!-- NAVBAR -->
<div class="navbar">

    <div class="nav-left">
        <button class="nav-btn" onclick="checkAuthAndGo('home.jsp')">
            <i class="fas fa-home"></i> Home
        </button>

        <button class="nav-btn" onclick="toggleDropdown('categoryMenu')">
            <i class="fas fa-bars"></i> Categories
        </button>

        <div class="dropdown-menu" id="categoryMenu">
            <a href="javascript:void(0)" onclick="checkAuthAndGo('products.jsp?cat=Vegetables')">Vegetables</a>
            <a href="javascript:void(0)" onclick="checkAuthAndGo('products.jsp?cat=Fruits')">Fruits</a>
            <a href="javascript:void(0)" onclick="checkAuthAndGo('products.jsp?cat=Grocery')">Grocery</a>
        </div>
    </div>

    <div class="nav-right">
        <button class="nav-btn" onclick="checkAuthAndGo('offers.jsp')">
            <i class="fas fa-tags"></i> Offers
        </button>

        <c:choose>
            <c:when test="${not empty sessionScope.user}">
                <button class="nav-btn" onclick="location.href='logout.jsp'">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </c:when>
            <c:otherwise>
                <button class="nav-btn" onclick="openLoginPopup()">
                    <i class="fas fa-user"></i> Login
                </button>
            </c:otherwise>
        </c:choose>
    </div>
</div>

<!-- LOGIN POPUP -->
<div id="loginPopup">
    <div class="popup-box">
        <h3>Please Login First</h3>
        <p>Continue shopping after login</p>

        <a href="login.jsp" class="nav-btn" style="color:#2ecc71;">Login</a><br><br>
        <a href="register.jsp" class="nav-btn" style="color:#3498db;">Register</a><br><br>

        <button onclick="closeLoginPopup()">Cancel</button>
    </div>
</div>

<script>
const IS_LOGGED_IN = <%= isLoggedIn %>;

function toggleDropdown(id) {
    closeAll();
    document.getElementById(id).style.display = "block";
    document.getElementById("overlay").style.display = "block";
}

function closeAll() {
    document.querySelectorAll(".dropdown-menu").forEach(d => d.style.display = "none");
    document.getElementById("overlay").style.display = "none";
}

function checkAuthAndGo(url) {
    if (!IS_LOGGED_IN) {
        openLoginPopup();
    } else {
        window.location.href = url;
    }
}

function openLoginPopup() {
    document.getElementById("loginPopup").style.display = "block";
}

function closeLoginPopup() {
    document.getElementById("loginPopup").style.display = "none";
}
</script>

</body>
</html>

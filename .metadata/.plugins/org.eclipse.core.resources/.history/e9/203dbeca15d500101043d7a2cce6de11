<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Header</title>

<!-- FontAwesome Icons -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">

<style>
/* =================== GLOBAL RESET =================== */
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

body {
	font-family: Arial, sans-serif;
}

/* =================== HEADER =================== */
.main-header {
	background: #131921;
	color: #fff;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	z-index: 1000;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

/* =================== MAIN CONTAINER =================== */
.header-container {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 12px 15px;
	gap: 20px;
}

/* =================== LOGO =================== */
.logo-section {
	display: flex;
	align-items: center;
	min-width: 140px;
}

.logo {
	font-size: 26px;
	font-weight: bold;
	color: #ff9900;
	text-decoration: none;
	display: flex;
	align-items: center;
	gap: 8px;
}

.logo:hover {
	color: #ffb84d;
}

/* =================== SEARCH =================== */
.search-section {
	flex: 1;
	max-width: 600px;
	min-width: 200px;
}

.search-container {
	display: flex;
	width: 100%;
}

.search-input {
	flex: 1;
	padding: 12px 15px;
	border: none;
	border-radius: 4px 0 0 4px;
	outline: none;
	font-size: 15px;
}

.search-btn {
	padding: 0 25px;
	background: #febd69;
	border: none;
	font-weight: 600;
	border-radius: 0 4px 4px 0;
	cursor: pointer;
	min-width: 60px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.search-btn:hover {
	background: #f3a847;
}

/* =================== ACTION BUTTONS =================== */
.action-section {
	display: flex;
	align-items: center;
	gap: 25px;
	min-width: 300px;
	justify-content: flex-end;
}

.header-btn {
	color: #fff;
	text-decoration: none;
	font-size: 15px;
	display: flex;
	align-items: center;
	gap: 6px;
	position: relative;
	cursor: pointer;
	padding: 8px 12px;
	border-radius: 4px;
	transition: all 0.3s ease;
}

.header-btn i {
	font-size: 20px;
}

.header-btn:hover {
	background: rgba(255, 255, 255, 0.1);
	color: #febd69;
}

/* CART COUNT */
.cart-count {
	background: #ff9900;
	color: #111;
	font-size: 12px;
	padding: 2px 6px;
	border-radius: 50%;
	position: absolute;
	top: -5px;
	right: -5px;
	min-width: 20px;
	height: 20px;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* =================== ACCOUNT DROPDOWN =================== */
.account-dropdown {
	position: relative;
}

.manual-dropdown-menu {
	position: absolute;
	left: 0;
	top: 100%;
	z-index: 1050;
	background-color: white;
	border: 1px solid rgba(0, 0, 0, .15);
	border-radius: 0.375rem;
	min-width: 200px;
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, .15);
	display: none;
}

.manual-dropdown-menu.show {
	display: block !important;
}

.dropdown-item {
	color: #212529 !important;
	padding: 0.75rem 1rem;
	text-decoration: none;
	display: block;
	border-bottom: 1px solid #eee;
}

.dropdown-item:last-child {
	border-bottom: none;
}

.dropdown-item:hover {
	background-color: #f8f9fa;
}

.user-welcome {
	padding: 12px 15px;
	background: #f8f9fa;
	border-bottom: 1px solid #eee;
	font-weight: 500;
	color: #333;
}

.dropdown-divider {
	height: 1px;
	background: #eee;
	margin: 5px 0;
}

/* =================== NAVIGATION =================== */
.main-nav {
	background: #232f3e;
	padding: 10px 0;
	margin-top: 56px; /* Header height */
}

.nav-container {
	display: flex;
	align-items: center;
	gap: 12px;
	padding: 6px 15px;
	flex-wrap: wrap;
}

.nav-btn {
	padding: 8px 16px;
	border-radius: 4px;
	font-size: 15px;
	text-decoration: none;
	color: #fff;
	cursor: pointer;
	display: flex;
	align-items: center;
	gap: 8px;
	transition: all 0.3s ease;
}

.nav-btn:hover {
	background: #37475a;
	color: #fff;
}

/* =================== CATEGORIES DROPDOWN =================== */
.dropdown {
	position: relative;
}

.category-dropdown-menu {
	position: absolute;
	left: 0;
	top: 100%;
	z-index: 1050;
	background-color: white;
	border: 1px solid rgba(0, 0, 0, .15);
	border-radius: 0.375rem;
	min-width: 200px;
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, .15);
	display: none;
	max-height: 400px;
	overflow-y: auto;
}

.category-dropdown-menu.show {
	display: block !important;
}

.category-item {
	color: #111 !important;
	padding: 10px 15px;
	display: flex;
	align-items: center;
	gap: 8px;
}

.category-item:hover {
	background: #ececec;
}

/* =================== MOBILE RESPONSIVE =================== */
@media ( max-width : 768px) {
	.main-header {
		padding: 8px 0;
	}
	.header-container {
		flex-direction: column;
		gap: 10px;
		padding: 10px 15px;
	}
	.logo-section {
		width: 100%;
		justify-content: center;
		min-width: auto;
	}
	.logo {
		font-size: 22px;
	}
	.search-section {
		width: 100%;
		max-width: 100%;
		min-width: auto;
	}
	.search-input {
		padding: 10px 12px;
		font-size: 14px;
	}
	.search-btn {
		padding: 0 20px;
		min-width: 50px;
	}
	.action-section {
		width: 100%;
		min-width: auto;
		justify-content: space-between;
		gap: 15px;
	}
	.header-btn {
		font-size: 14px;
		padding: 6px 10px;
		flex-direction: column;
		gap: 3px;
		min-width: 70px;
	}
	.header-btn i {
		font-size: 18px;
	}
	.cart-count {
		font-size: 11px;
		padding: 1px 5px;
		top: -3px;
		right: -3px;
		min-width: 18px;
		height: 18px;
	}

	/* Adjust dropdowns for mobile */
	.manual-dropdown-menu, .category-dropdown-menu {
		position: fixed;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%);
		width: 90%;
		max-width: 300px;
		z-index: 1100;
	}

	/* Mobile nav adjustments */
	.main-nav {
		margin-top: 140px; /* Adjusted for mobile header height */
		padding: 8px 0;
	}
	.nav-container {
		flex-direction: column;
		gap: 8px;
		padding: 0 10px;
	}
	.nav-btn {
		width: 100%;
		padding: 10px 15px;
		justify-content: center;
	}

	/* Mobile menu toggle */
	.mobile-menu-toggle {
		display: none;
	}
}

/* =================== TABLET (769px - 991px) =================== */
@media ( min-width : 769px) and (max-width: 991px) {
	.header-container {
		gap: 15px;
	}
	.logo {
		font-size: 24px;
	}
	.search-section {
		max-width: 400px;
	}
	.action-section {
		min-width: 250px;
		gap: 20px;
	}
	.header-btn {
		font-size: 14px;
		padding: 6px 10px;
	}
}

/* =================== DESKTOP (992px and up) =================== */
@media ( min-width : 992px) {
	.header-container {
		padding: 12px 20px;
	}
	.search-section {
		max-width: 500px;
	}
	.action-section {
		min-width: 350px;
	}
}

/* =================== EXTRA SMALL MOBILE (480px and below) =================== */
@media ( max-width : 480px) {
	.header-btn {
		min-width: 60px;
	}
	.header-btn span:not(.cart-count) {
		font-size: 11px;
	}
	.logo {
		font-size: 20px;
	}
}

/* =================== UTILITY CLASSES =================== */
.container {
	width: 100%;
	max-width: 100%;
}

.text-danger {
	color: #dc3545 !important;
}

.text-danger:hover {
	color: #c82333 !important;
}
</style>
</head>

<body>

	<!-- Header -->
	<header class="main-header">
		<div class="header-container">
			<!-- Logo Section -->
			<div class="logo-section">
				<a href="/" class="logo"> <i class="fas fa-shopping-bag"></i> <span>FreshMart</span>
				</a>
			</div>

			<!-- Search Section -->
			<div class="search-section">
				<div class="search-container">
					<input type="text" class="search-input"
						placeholder="Search for products, brands and more">
					<button class="search-btn">
						<i class="fas fa-search"></i>
					</button>
				</div>
			</div>

			<!-- Action Buttons Section -->
			<div class="action-section">
				<!-- Account Dropdown -->
				<div class="account-dropdown">
					<c:choose>
						<c:when test="${not empty sessionScope.user}">
							<!-- LOGGED IN USER -->
							<a class="header-btn" href="javascript:void(0)"
								onclick="toggleDropdown('userMenu')"> <i
								class="fas fa-user-circle"></i> <span>${fn:substringBefore(sessionScope.user.name, ' ')}</span>
							</a>

							<div class="manual-dropdown-menu" id="userMenu">
								<div class="user-welcome">Hello,
									${sessionScope.user.name}!</div>
								<a class="dropdown-item"
									href="${pageContext.request.contextPath}/profile"> <i
									class="fas fa-user"></i> My Profile
								</a> <a class="dropdown-item"
									href="${pageContext.request.contextPath}/orders"> <i
									class="fas fa-shopping-bag"></i> My Orders
								</a> <a class="dropdown-item"
									href="${pageContext.request.contextPath}/wishlist"> <i
									class="fas fa-heart"></i> Wishlist
								</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item text-danger"
									href="${pageContext.request.contextPath}/logout"> <i
									class="fas fa-sign-out-alt"></i> Logout
								</a>
							</div>
						</c:when>
						<c:otherwise>
							<!-- GUEST USER -->
							<a class="header-btn" href="javascript:void(0)"
								onclick="toggleDropdown('guestMenu')"> <i
								class="fas fa-user"></i> <span>Account</span>
							</a>

							<div class="manual-dropdown-menu" id="guestMenu">
								<a class="dropdown-item"
									href="${pageContext.request.contextPath}/Login"> <i
									class="fas fa-sign-in-alt"></i> Login
								</a> <a class="dropdown-item"
									href="${pageContext.request.contextPath}/register"> <i
									class="fas fa-user-plus"></i> Register
								</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item"
									href="${pageContext.request.contextPath}/customer-service">
									<i class="fas fa-headset"></i> Customer Service
								</a>
							</div>
						</c:otherwise>
					</c:choose>
				</div>

				<!-- Wishlist -->
				<a href="${pageContext.request.contextPath}/wishlist"
					class="header-btn"> <i class="fas fa-heart"></i> <span>Wishlist</span>
				</a>

				<!-- Cart -->
				<a href="${pageContext.request.contextPath}/cart" class="header-btn">
					<i class="fas fa-shopping-cart"></i> <span>Cart</span> <span
					class="cart-count"> <c:choose>
							<c:when
								test="${not empty sessionScope.cartCount && sessionScope.cartCount > 0}">
                            ${sessionScope.cartCount}
                        </c:when>
							<c:otherwise>0</c:otherwise>
						</c:choose>
				</span>
				</a>
			</div>
		</div>
	</header>

	<!-- Navigation -->
	<nav class="main-nav">
		<div class="nav-container">
			<!-- Categories Dropdown -->
			<div class="dropdown">
				<button class="nav-btn dropdown-toggle" type="button"
					onclick="toggleDropdown('categoryMenu')">
					<i class="fas fa-bars me-1"></i> All Categories
				</button>

				<ul class="category-dropdown-menu" id="categoryMenu">
					<c:forEach var="c" items="${categories}">
						<li><a class="dropdown-item category-item"
							href="${pageContext.request.contextPath}/products?categories=${c.name}">
								<i class="fa-solid fa-tag"></i> ${c.name}
						</a></li>
					</c:forEach>
				</ul>
			</div>

			<!-- Other Pages -->
			<a href="${pageContext.request.contextPath}/products" class="nav-btn">
				<i class="fas fa-store"></i> Products
			</a> <a href="${pageContext.request.contextPath}/offers" class="nav-btn">
				<i class="fas fa-tags"></i> Offers
			</a> <a href="${pageContext.request.contextPath}/customer-service"
				class="nav-btn"> <i class="fas fa-headset"></i> Customer Service
			</a>
		</div>
	</nav>

	<!-- Dropdown Overlay for Mobile -->
	<div class="dropdown-overlay" id="dropdownOverlay"
		onclick="closeAllDropdowns()"></div>

	<script>
// ================= DROPDOWN MANAGEMENT =================
let currentDropdown = null;

function toggleDropdown(menuId) {
    const menu = document.getElementById(menuId);
    const overlay = document.getElementById('dropdownOverlay');
    
    if (!menu) return;
    
    if (currentDropdown === menuId) {
        // Close current dropdown
        closeDropdown();
        if (overlay) overlay.classList.remove('show');
    } else {
        // Close any open dropdown first
        closeDropdown();
        
        // Open new dropdown
        currentDropdown = menuId;
        menu.classList.add('show');
        
        // Show overlay on mobile
        if (window.innerWidth <= 768) {
            if (overlay) overlay.classList.add('show');
            document.body.style.overflow = 'hidden';
        }
    }
}

function closeDropdown() {
    if (currentDropdown) {
        const menu = document.getElementById(currentDropdown);
        const overlay = document.getElementById('dropdownOverlay');
        
        if (menu) menu.classList.remove('show');
        if (overlay) overlay.classList.remove('show');
        
        document.body.style.overflow = '';
        currentDropdown = null;
    }
}

function closeAllDropdowns() {
    document.querySelectorAll('.manual-dropdown-menu, .category-dropdown-menu').forEach(function(menu) {
        menu.classList.remove('show');
    });
    const overlay = document.getElementById('dropdownOverlay');
    if (overlay) overlay.classList.remove('show');
    document.body.style.overflow = '';
    currentDropdown = null;
}

// Close dropdown when clicking outside (for desktop)
document.addEventListener('click', function(event) {
    if (window.innerWidth > 768) {
        if (!event.target.closest('.account-dropdown') && 
            !event.target.closest('.dropdown') &&
            !event.target.closest('.manual-dropdown-menu') &&
            !event.target.closest('.category-dropdown-menu')) {
            closeAllDropdowns();
        }
    }
});

// Close dropdown on escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeAllDropdowns();
    }
});

// Create overlay element if it doesn't exist
if (!document.getElementById('dropdownOverlay')) {
    const overlay = document.createElement('div');
    overlay.id = 'dropdownOverlay';
    overlay.className = 'dropdown-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1099;
        display: none;
    `;
    overlay.onclick = closeAllDropdowns;
    document.body.appendChild(overlay);
}

// ================= SEARCH FUNCTIONALITY =================
document.querySelector('.search-btn').addEventListener('click', function() {
    const searchInput = document.querySelector('.search-input');
    const searchTerm = searchInput.value.trim();
    
    if (searchTerm) {
        window.location.href = '${pageContext.request.contextPath}/products?search=' + encodeURIComponent(searchTerm);
    }
});

document.querySelector('.search-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        const searchTerm = this.value.trim();
        if (searchTerm) {
            window.location.href = '${pageContext.request.contextPath}/products?search=' + encodeURIComponent(searchTerm);
        }
    }
});

// ================= CART COUNT UPDATE =================
function updateCartCount(count) {
    const cartCountElement = document.querySelector('.cart-count');
    if (cartCountElement) {
        cartCountElement.textContent = count;
        
        // Animation
        cartCountElement.style.transform = 'scale(1.3)';
        setTimeout(() => {
            cartCountElement.style.transform = 'scale(1)';
        }, 300);
    }
}

// ================= WINDOW RESIZE HANDLER =================
window.addEventListener('resize', function() {
    // Close dropdown overlay on resize to desktop
    if (window.innerWidth > 768) {
        closeAllDropdowns();
    }
});

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    closeAllDropdowns();
});

// Add CSS for dropdown overlay
const overlayStyle = document.createElement('style');
overlayStyle.textContent = `
    .dropdown-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1099;
        display: none;
    }
    .dropdown-overlay.show {
        display: block;
    }
`;
document.head.appendChild(overlayStyle);
</script>

	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
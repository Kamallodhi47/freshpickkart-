<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>

<style>
/* =================== HEADER CSS - UNIQUE CLASSES =================== */
/* Main Header */
.header-main-container {
    background: linear-gradient(135deg, #131921 0%, #232f3e 100%);
    color: #fff;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* Header Container */
.header-wrapper {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    padding: 12px 15px;
    gap: 12px;
    width: 100%;
    height: 60px;
    background: linear-gradient(135deg, #d0dbe7, #232f3e 100%);
}

/* Logo Section */
.header-logo-area {
    display: flex;
    align-items: center;
    justify-content: flex-start;
}

.header-logo-link {
    text-decoration: none;
    display: block;
}

.header-logo-img {
    height: 180px;
    width: auto;
    object-fit: contain;
    padding-right: 40px;
}

/* Search Section */
.header-search-area {
    position: relative;
    width: 100%;
}

.header-search-box {
    display: flex;
    width: 100%;
    height: 40px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    background: white;
}

.header-search-field {
    flex: 1;
    padding: 0 15px;
    border: none;
    outline: none;
    font-size: 14px;
    color: #333;
    background: transparent;
}

.header-search-field::placeholder {
    color: #888;
    font-size: 13px;
}

.header-search-button {
    padding: 0 18px;
    background: linear-gradient(135deg, #ff9900 0%, #ffac31 100%);
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    transition: all 0.3s ease;
}

.header-search-button:hover {
    background: linear-gradient(135deg, #ff8c00 0%, #ff9a00 100%);
}

.header-search-button i {
    font-size: 16px;
}

/* Action Buttons */
.header-actions-area {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-end;
}

.header-action-button {
    color: #fff;
    text-decoration: none;
    font-size: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    position: relative;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
    min-width: 44px;
    min-height: 44px;
    justify-content: center;
}

.header-action-button i {
    font-size: 18px;
    margin-bottom: 2px;
}

.header-action-button-text {
    font-size: 10px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 60px;
}

.header-action-button:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

/* Cart Count */
.header-cart-badge {
    background: linear-gradient(135deg, #ff4444 0%, #ff6b6b 100%);
    color: white;
    font-size: 10px;
    font-weight: bold;
    padding: 1px 5px;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    right: 2px;
    min-width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Account Dropdown */
.header-account-wrapper {
    position: relative;
}

.header-dropdown-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1100;
    background-color: white;
    border-radius: 16px;
    width: 90%;
    max-width: 320px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    display: none;
    overflow: hidden;
    animation: header-dropdown-slide 0.3s ease;
}

@keyframes header-dropdown-slide {
    from {
        opacity: 0;
        transform: translate(-50%, -40%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

.header-dropdown-menu.show {
    display: block !important;
}

.header-dropdown-item {
    color: #333 !important;
    padding: 14px 20px;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 15px;
    border-bottom: 1px solid #f0f0f0;
    transition: all 0.2s ease;
}

.header-dropdown-item:last-child {
    border-bottom: none;
}

.header-dropdown-item:hover {
    background-color: #f8f9fa;
    padding-left: 25px;
}

.header-dropdown-item i {
    width: 20px;
    text-align: center;
    color: #666;
}

.header-user-greeting {
    padding: 18px 20px;
    background: linear-gradient(135deg, #4a6cf7 0%, #6c63ff 100%);
    color: white;
    font-weight: 600;
    font-size: 16px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.header-dropdown-separator {
    height: 1px;
    background: #eee;
    margin: 5px 0;
}

/* Navigation */
.header-navigation-bar {
    background: linear-gradient(135deg, #232f3e 0%, #37475a 100%);
    padding: 12px 0;
    margin-top: 60px;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.header-nav-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 15px;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
}

.header-nav-wrapper::-webkit-scrollbar {
    display: none;
}

.header-nav-button {
    padding: 10px 14px;
    border-radius: 25px;
    font-size: 13px;
    text-decoration: none;
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
    white-space: nowrap;
    flex-shrink: 0;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-height: 40px;
}

.header-nav-button:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.header-nav-button i {
    font-size: 14px;
}

/* Categories Dropdown */
.header-category-wrapper {
    position: relative;
    flex-shrink: 0;
}

.header-category-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1100;
    background-color: white;
    border-radius: 16px;
    width: 90%;
    max-width: 320px;
    max-height: 70vh;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    display: none;
    overflow-y: auto;
    animation: header-dropdown-slide 0.3s ease;
}

.header-category-menu.show {
    display: block !important;
}

.header-category-item {
    color: #333 !important;
    padding: 14px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 15px;
    border-bottom: 1px solid #f0f0f0;
    transition: all 0.2s ease;
}

.header-category-item:hover {
    background: #f8f9fa;
    padding-left: 25px;
}

.header-category-item i {
    color: #4a6cf7;
    width: 20px;
    text-align: center;
}

/* Mobile Overlay */
.header-dropdown-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1099;
    display: none;
    backdrop-filter: blur(5px);
    animation: header-fade-in 0.3s ease;
}

@keyframes header-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
}

.header-dropdown-backdrop.show {
    display: block;
}

/* Mobile Bottom Navigation */
.header-mobile-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: white;
    display: none;
    justify-content: space-around;
    padding: 12px 0 8px;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    z-index: 1000;
    border-top: 1px solid #eee;
    backdrop-filter: blur(10px);
}

.header-mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: #666;
    font-size: 10px;
    flex: 1;
    padding: 4px 0;
    transition: all 0.3s ease;
}

.header-mobile-nav-item i {
    font-size: 18px;
    margin-bottom: 4px;
    color: #4a6cf7;
}

.header-mobile-nav-item.active {
    color: #4a6cf7;
    font-weight: 600;
}

.header-mobile-nav-item span {
    font-size: 10px;
}

/* =================== RESPONSIVE DESIGN =================== */

/* Tablet */
@media (min-width: 768px) {
    .header-wrapper {
        height: 70px;
        padding: 15px 20px;
        gap: 20px;
    }
    
    .header-search-box {
        height: 44px;
    }
    
    .header-search-field {
        font-size: 15px;
        padding: 0 20px;
    }
    
    .header-search-button {
        padding: 0 25px;
        min-width: 60px;
    }
    
    .header-actions-area {
        gap: 15px;
    }
    
    .header-action-button {
        flex-direction: row;
        gap: 6px;
        padding: 8px 12px;
        font-size: 14px;
        min-width: auto;
    }
    
    .header-action-button i {
        margin-bottom: 0;
        font-size: 20px;
    }
    
    .header-action-button-text {
        font-size: 13px;
        max-width: none;
    }
    
    .header-cart-badge {
        top: 5px;
        right: 5px;
        font-size: 11px;
        min-width: 18px;
        height: 18px;
    }
    
    .header-navigation-bar {
        margin-top: 70px;
    }
    
    .header-nav-button {
        padding: 12px 18px;
        font-size: 14px;
        gap: 8px;
    }
    
    .header-nav-button i {
        font-size: 16px;
    }
    
    .header-mobile-nav {
        display: none !important;
    }
}

/* Desktop */
@media (min-width: 992px) {
    .header-wrapper {
        height: 80px;
        padding: 0 30px;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .header-search-box {
        height: 48px;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .header-search-field {
        font-size: 16px;
    }
    
    .header-search-button {
        padding: 0 30px;
        min-width: 70px;
    }
    
    .header-actions-area {
        gap: 25px;
    }
    
    .header-action-button {
        padding: 10px 16px;
        font-size: 15px;
        gap: 8px;
    }
    
    .header-action-button i {
        font-size: 22px;
    }
    
    .header-dropdown-menu,
    .header-category-menu {
        position: absolute;
        top: 100%;
        left: 0;
        transform: none;
        width: 280px;
        max-width: 280px;
        animation: header-dropdown-down 0.3s ease;
    }
    
    @keyframes header-dropdown-down {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .header-navigation-bar {
        margin-top: 80px;
        padding: 15px 0;
    }
    
    .header-nav-wrapper {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 30px;
        justify-content: flex-start;
        gap: 15px;
        overflow-x: visible;
    }
    
    .header-nav-button {
        padding: 12px 20px;
        font-size: 15px;
        gap: 10px;
    }
    
    .header-dropdown-backdrop {
        display: none !important;
    }
}

/* Large Desktop */
@media (min-width: 1200px) {
    .header-wrapper {
        max-width: 1600px;
    }
    
    .header-nav-wrapper {
        max-width: 1600px;
    }
    
    .header-search-box {
        max-width: 700px;
    }
}

/* Touch Optimizations */
@media (hover: none) and (pointer: coarse) {
    .header-action-button:hover,
    .header-nav-button:hover,
    .header-dropdown-item:hover,
    .header-category-item:hover {
        transform: none;
        background: none;
    }
    
    .header-action-button:active,
    .header-nav-button:active {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(0.95);
    }
}

/* Dark Mode */
@media (prefers-color-scheme: dark) {
    .header-dropdown-menu,
    .header-category-menu {
        background-color: #1e1e1e;
        border: 1px solid #333;
    }
    
    .header-dropdown-item,
    .header-category-item {
        color: #e0e0e0 !important;
        border-bottom-color: #333;
    }
    
    .header-dropdown-item:hover,
    .header-category-item:hover {
        background-color: #2a2a2a;
    }
    
    .header-user-greeting {
        background: linear-gradient(135deg, #3a5ce5 0%, #5b52e6 100%);
    }
}

/* Utility Classes */
.header-text-danger {
    color: #ff4444 !important;
}

.header-text-danger:hover {
    color: #ff0000 !important;
    background: rgba(255, 68, 68, 0.1);
}
</style>

<!-- Header Structure -->
<header class="header-main-container">
    <div class="header-wrapper">
        <!-- Logo Section -->
        <div class="header-logo-area">
            <a href="${pageContext.request.contextPath}" class="header-logo-link">
                <img 
                    src="${pageContext.request.contextPath}/assets/img/Seller_img/generated-image__4_-removebg-preview.png" 
                    alt="FreshpickKart Logo" 
                    loading="lazy"
                    width="263"
                    height="200"
                    decoding="async"
                    class="header-logo-img"
                />
            </a>
        </div>

        <!-- Search Section -->
        <div class="header-search-area">
            <div class="header-search-box">
                <input type="text" class="header-search-field"
                    placeholder="Search products..." id="headerSearchInput">
                <button class="header-search-button" id="headerSearchButton">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="header-actions-area">
            <!-- Account Dropdown -->
            <div class="header-account-wrapper">
                <c:choose>
                    <c:when test="${not empty sessionScope.user}">
                        <!-- LOGGED IN USER -->
                        <a class="header-action-button" href="javascript:void(0)"
                            onclick="headerFunctions.toggleDropdown('headerUserMenu')" id="headerAccountButton"> 
                            <i class="fas fa-user-circle"></i> 
                            <span class="header-action-button-text">${fn:substringBefore(sessionScope.user.name, ' ')}</span>
                        </a>

                        <div class="header-dropdown-menu" id="headerUserMenu">
                            <div class="header-user-greeting">Hello, ${sessionScope.user.name}!</div>
                            <a class="header-dropdown-item"
                                href="${pageContext.request.contextPath}/profile"> 
                                <i class="fas fa-user"></i> My Profile 
                            </a> 
                            <a class="header-dropdown-item"
                                href="${pageContext.request.contextPath}/orders"> 
                                <i class="fas fa-shopping-bag"></i> My Orders
                            </a> 
                            <a class="header-dropdown-item"
                                href="${pageContext.request.contextPath}/wishlist"> 
                                <i class="fas fa-heart"></i> Wishlist
                            </a>
                            <div class="header-dropdown-separator"></div>
                            <a class="header-dropdown-item header-text-danger"
                                href="${pageContext.request.contextPath}/logout"> 
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </c:when>
                    <c:otherwise>
                        <!-- GUEST USER -->
                        <a class="header-action-button" href="javascript:void(0)"
                            onclick="headerFunctions.toggleDropdown('headerGuestMenu')" id="headerAccountButton"> 
                            <i class="fas fa-user"></i> 
                            <span class="header-action-button-text">Account</span>
                        </a>

                        <div class="header-dropdown-menu" id="headerGuestMenu">
                            <a class="header-dropdown-item"
                                href="${pageContext.request.contextPath}/Login"> 
                                <i class="fas fa-sign-in-alt"></i> Login
                            </a> 
                            <a class="header-dropdown-item"
                                href="${pageContext.request.contextPath}/register"> 
                                <i class="fas fa-user-plus"></i> Register
                            </a>
                            <div class="header-dropdown-separator"></div>
                            <a class="header-dropdown-item"
                                href="${pageContext.request.contextPath}/service"> 
                                <i class="fas fa-headset"></i> Customer Service
                            </a>
                        </div>
                    </c:otherwise>
                </c:choose>
            </div>

            <!-- Wishlist -->
            <a href="${pageContext.request.contextPath}/wishlist" class="header-action-button" id="headerWishlistButton"> 
                <i class="fas fa-heart"></i> 
                <span class="header-action-button-text">Wishlist</span>
            </a>

            <!-- Cart -->
            <a href="${pageContext.request.contextPath}/cart" class="header-action-button" id="headerCartButton">
                <i class="fas fa-shopping-cart"></i> 
                <span class="header-action-button-text">Cart</span> 
                <span class="header-cart-badge" id="headerCartCount"> 
                    <c:choose>
                        <c:when test="${not empty sessionScope.cartCount && sessionScope.cartCount > 0}">
                            ${sessionScope.cartCount}
                        </c:when>
                        <c:otherwise>0</c:otherwise>
                    </c:choose>
                </span>
            </a>
        </div>
    </div>
</header>

<!-- Navigation -->
<nav class="header-navigation-bar">
    <div class="header-nav-wrapper">
        <!-- Categories Dropdown -->
        <div class="header-category-wrapper">
            <button class="header-nav-button" type="button"
                onclick="headerFunctions.toggleDropdown('headerCategoryMenu')" id="headerCategoryButton">
                <i class="fas fa-bars"></i> 
                <span class="header-action-button-text">Categories</span>
            </button>

            <ul class="header-category-menu" id="headerCategoryMenu">
                <c:forEach var="c" items="${categories}">
                    <li><a class="header-category-item"
                        href="${pageContext.request.contextPath}/products?categories=${c.name}"> 
                        <i class="fa-solid fa-tag"></i> ${c.name}
                    </a></li>
                </c:forEach>
            </ul>
        </div>
        
        <a href="${pageContext.request.contextPath}/" class="header-nav-button" id="headerHomeButton">
            <i class="fas fa-home"></i> 
            <span class="header-action-button-text">Home</span>
        </a> 
        
        <!-- Products -->
        <a href="${pageContext.request.contextPath}/products" class="header-nav-button" id="headerProductsButton">
            <i class="fas fa-store"></i> 
            <span class="header-action-button-text">Products</span>
        </a> 
        
        <!-- Offers -->
        <a href="${pageContext.request.contextPath}/offers" class="header-nav-button" id="headerOffersButton">
            <i class="fas fa-tags"></i> 
            <span class="header-action-button-text">Offers</span>
        </a> 
        
        <!-- Customer Service -->
        <a href="${pageContext.request.contextPath}/service" class="header-nav-button" id="headerServiceButton"> 
            <i class="fas fa-headset"></i> 
            <span class="header-action-button-text">Service</span>
        </a>
    </div>
</nav>

<!-- Mobile Bottom Navigation -->
<nav class="header-mobile-nav" id="headerMobileNav">
    <a href="${pageContext.request.contextPath}/" class="header-mobile-nav-item active">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </a>
    <a href="${pageContext.request.contextPath}/categories" class="header-mobile-nav-item">
        <i class="fas fa-th-large"></i>
        <span>Categories</span>
    </a>
    <a href="${pageContext.request.contextPath}/cart" class="header-mobile-nav-item">
        <i class="fas fa-shopping-cart"></i>
        <span>Cart</span>
    </a>
    <a href="${pageContext.request.contextPath}/account" class="header-mobile-nav-item">
        <i class="fas fa-user"></i>
        <span>Account</span>
    </a>
</nav>

<!-- Dropdown Overlay -->
<div class="header-dropdown-backdrop" id="headerDropdownBackdrop"
    onclick="headerFunctions.closeAllDropdowns()"></div>

<script>
// ================= HEADER JAVASCRIPT - UNIQUE NAMES =================
const headerFunctions = (function() {
    // Private variables
    let currentHeaderDropdown = null;
    
    // Mobile detection
    const isMobileDevice = () => {
        return window.innerWidth <= 768 || 
               /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    };
    
    // Dropdown management
    function toggleHeaderDropdown(menuId) {
        const menu = document.getElementById(menuId);
        const backdrop = document.getElementById('headerDropdownBackdrop');
        
        if (!menu) return;
        
        if (currentHeaderDropdown === menuId) {
            closeHeaderDropdown();
        } else {
            closeHeaderDropdown();
            currentHeaderDropdown = menuId;
            menu.classList.add('show');
            
            // Mobile specific behavior
            if (isMobileDevice()) {
                if (backdrop) backdrop.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }
    }
    
    function closeHeaderDropdown() {
        if (currentHeaderDropdown) {
            const menu = document.getElementById(currentHeaderDropdown);
            const backdrop = document.getElementById('headerDropdownBackdrop');
            
            if (menu) menu.classList.remove('show');
            if (backdrop) backdrop.classList.remove('show');
            
            document.body.style.overflow = '';
            currentHeaderDropdown = null;
        }
    }
    
    function closeAllHeaderDropdowns() {
        document.querySelectorAll('.header-dropdown-menu, .header-category-menu').forEach(function(menu) {
            menu.classList.remove('show');
        });
        const backdrop = document.getElementById('headerDropdownBackdrop');
        if (backdrop) backdrop.classList.remove('show');
        document.body.style.overflow = '';
        currentHeaderDropdown = null;
    }
    
    // Search functionality
    function initHeaderSearch() {
        const searchInput = document.getElementById('headerSearchInput');
        const searchButton = document.getElementById('headerSearchButton');
        
        if (!searchInput || !searchButton) return;
        
        function performHeaderSearch() {
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                window.location.href = '${pageContext.request.contextPath}/products?search=' + encodeURIComponent(searchTerm);
            }
        }
        
        searchButton.addEventListener('click', performHeaderSearch);
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performHeaderSearch();
            }
        });
        
        // Mobile search enhancement
        if (isMobileDevice()) {
            searchInput.addEventListener('focus', function() {
                this.parentElement.style.boxShadow = '0 5px 20px rgba(255, 153, 0, 0.3)';
            });
            
            searchInput.addEventListener('blur', function() {
                this.parentElement.style.boxShadow = '0 3px 8px rgba(0, 0, 0, 0.2)';
            });
        }
    }
    
    // Cart functionality
    function updateHeaderCartCount(count) {
        const cartCountElement = document.getElementById('headerCartCount');
        if (cartCountElement) {
            cartCountElement.textContent = count;
            
            // Mobile animation
            if (isMobileDevice()) {
                cartCountElement.style.transform = 'scale(1.5)';
                cartCountElement.style.background = 'linear-gradient(135deg, #ff0000 0%, #ff6b6b 100%)';
                
                // Vibrate on mobile
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                
                setTimeout(() => {
                    cartCountElement.style.transform = 'scale(1)';
                    cartCountElement.style.background = 'linear-gradient(135deg, #ff4444 0%, #ff6b6b 100%)';
                }, 300);
            }
        }
    }
    
    // Mobile navigation
    function initHeaderMobileNav() {
        const mobileNav = document.getElementById('headerMobileNav');
        
        function checkHeaderScreenSize() {
            if (window.innerWidth <= 480) {
                if (mobileNav) mobileNav.style.display = 'flex';
                document.body.style.paddingBottom = '60px';
            } else {
                if (mobileNav) mobileNav.style.display = 'none';
                document.body.style.paddingBottom = '';
            }
        }
        
        checkHeaderScreenSize();
        window.addEventListener('resize', checkHeaderScreenSize);
    }
    
    // Touch optimizations
    function initHeaderTouchOptimizations() {
        // Add touch feedback to all buttons
        const touchElements = document.querySelectorAll('.header-action-button, .header-nav-button, .header-mobile-nav-item');
        touchElements.forEach(el => {
            el.addEventListener('touchstart', function() {
                this.style.opacity = '0.8';
                this.style.transform = 'scale(0.95)';
            });
            
            el.addEventListener('touchend', function() {
                this.style.opacity = '';
                this.style.transform = '';
            });
        });
        
        // Close dropdown when clicking outside (desktop only)
        if (!isMobileDevice()) {
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.header-account-wrapper') && 
                    !event.target.closest('.header-category-wrapper') &&
                    !event.target.closest('.header-dropdown-menu') &&
                    !event.target.closest('.header-category-menu')) {
                    closeAllHeaderDropdowns();
                }
            });
        }
        
        // Close dropdown on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAllHeaderDropdowns();
            }
        });
    }
    
    // Window resize handler
    function initHeaderResizeHandler() {
        let headerResizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(headerResizeTimeout);
            headerResizeTimeout = setTimeout(function() {
                // Close dropdowns when switching from mobile to desktop
                if (!isMobileDevice()) {
                    closeAllHeaderDropdowns();
                }
                
                // Update mobile bottom nav
                const mobileNav = document.getElementById('headerMobileNav');
                if (window.innerWidth <= 480) {
                    if (mobileNav) mobileNav.style.display = 'flex';
                    document.body.style.paddingBottom = '60px';
                } else {
                    if (mobileNav) mobileNav.style.display = 'none';
                    document.body.style.paddingBottom = '';
                }
            }, 150);
        });
    }
    
    // Initialize all header functions
    function initHeaderFunctions() {
        initHeaderSearch();
        initHeaderMobileNav();
        initHeaderTouchOptimizations();
        initHeaderResizeHandler();
        closeAllHeaderDropdowns();
        
        // Mobile performance optimizations
        if (isMobileDevice()) {
            document.addEventListener('touchmove', function() {}, { passive: true });
        }
    }
    
    // Public API
    return {
        init: initHeaderFunctions,
        toggleDropdown: toggleHeaderDropdown,
        closeDropdown: closeHeaderDropdown,
        closeAllDropdowns: closeAllHeaderDropdowns,
        updateCartCount: updateHeaderCartCount,
        isMobile: isMobileDevice
    };
})();

// Initialize header on DOM ready
document.addEventListener('DOMContentLoaded', function() {
    headerFunctions.init();
});
</script>
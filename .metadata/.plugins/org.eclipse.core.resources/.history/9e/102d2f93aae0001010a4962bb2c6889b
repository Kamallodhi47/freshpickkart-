<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>FreshpickKart - Premium Shopping Experience</title>

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Google Fonts -->
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@400;500;600;700&display=swap"
	rel="stylesheet">

<style>
/* ========== GLOBAL STYLES ========== */
:root {
	--primary: #4a6cf7;
	--secondary: #6c63ff;
	--accent: #ff6b8b;
	--success: #28a745;
	--warning: #ffcf2b;
	--dark: #2a2d3b;
	--light: #f8fafc;
	--text: #64748b;
}

* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	-webkit-tap-highlight-color: transparent;
}

html {
	font-size: 16px;
}

body {
	background: linear-gradient(135deg, #f8fafc 0%, #e4edf5 100%);
	font-family: 'Poppins', sans-serif;
	color: var(--dark);
	min-height: 100vh;
	padding-top: 70px;
	overflow-x: hidden;
	touch-action: pan-y;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

h1, h2, h3, h4, h5, h6 {
	font-family: 'Montserrat', sans-serif;
	font-weight: 700;
}

/* Force dark text colors for dark mode compatibility */
.text-dark {
	color: #2a2d3b !important;
}

.text-danger {
	color: #dc3545 !important;
}

.text-success {
	color: #28a745 !important;
}

.text-muted {
	color: #6c757d !important;
}

/* ========== MOBILE FIRST DESIGN ========== */

/* ========== MOBILE HERO SECTION ========== */
.fresh-hero {
	height: 280px;
	position: relative;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 0 0 20px 20px;
	margin: 0 0 15px 0;
	background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
	box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

/* Single hero image for mobile */
.fresh-hero-image {
	width: 100%;
	height: 100%;
	object-fit: cover;
	opacity: 0.7;
}

.fresh-content {
	position: absolute;
	text-align: center;
	color: white;
	padding: 20px;
	border-radius: 15px;
	background: rgba(0, 0, 0, 0.6);
	backdrop-filter: blur(10px);
	-webkit-backdrop-filter: blur(10px);
	border: 1px solid rgba(255, 255, 255, 0.15);
	z-index: 10;
	width: 92%;
	max-width: 400px;
	animation: fadeInUp 0.8s ease;
	box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.fresh-content h1 {
	font-size: 1.5rem;
	font-weight: 800;
	margin-bottom: 8px;
	line-height: 1.3;
	color: white !important;
	text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.fresh-content p {
	font-size: 0.85rem;
	margin-bottom: 15px;
	opacity: 0.9;
	color: #e0e0e0 !important;
	line-height: 1.4;
}

.fresh-btn {
	padding: 12px 25px;
	background: linear-gradient(135deg, var(--warning) 0%, #ffa726 100%);
	font-weight: 700;
	border-radius: 10px;
	color: #111 !important;
	text-decoration: none;
	display: inline-block;
	transition: all 0.3s ease;
	border: none;
	font-size: 0.9rem;
	box-shadow: 0 6px 15px rgba(255, 207, 43, 0.4);
	min-height: 44px;
	min-width: 120px;
}

.fresh-btn:hover {
	transform: translateY(-3px);
	box-shadow: 0 10px 20px rgba(255, 207, 43, 0.6);
	color: #111 !important;
}

@
keyframes fadeInUp {from { opacity:0;
	transform: translateY(20px) scale(0.95);
}

to {
	opacity: 1;
	transform: translateY(0) scale(1);
}

}

/* ========== MOBILE MAIN CONTAINER ========== */
.main-container {
	width: 94%;
	margin: 0 auto 20px;
	padding: 15px;
	background: #ffffff;
	border-radius: 20px;
	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
	border: 1px solid rgba(255, 255, 255, 0.8);
	position: relative;
	overflow: hidden;
}

.main-container::before {
	content: '';
	position: absolute;
	top: -50%;
	left: -50%;
	width: 200%;
	height: 200%;
	background: radial-gradient(circle, rgba(74, 108, 247, 0.03) 0%,
		transparent 70%);
	z-index: -1;
}

/* ========== MOBILE SECTION TITLE ========== */
.bg-section {
	margin-bottom: 25px;
	padding: 0 5px;
}

.section-title {
	text-align: center;
	font-weight: 800;
	color: var(--dark);
	margin-bottom: 20px;
	position: relative;
	font-size: 1.3rem;
	padding-bottom: 10px;
	display: inline-block;
	width: 100%;
}

.section-title::after {
	content: '';
	width: 60px;
	height: 3px;
	background: linear-gradient(135deg, var(--primary) 0%, var(--secondary)
		100%);
	position: absolute;
	bottom: 0;
	left: 50%;
	transform: translateX(-50%);
	border-radius: 4px;
}

/* ========== MOBILE HORIZONTAL SCROLL ========== */
.offer-row {
	display: flex;
	gap: 12px;
	overflow-x: auto;
	padding: 10px 5px;
	scroll-behavior: smooth;
	-webkit-overflow-scrolling: touch;
	scrollbar-width: none;
	margin: 0 -5px;
	width: calc(100% + 10px);
}

.offer-row::-webkit-scrollbar {
	display: none;
}

/* ========== COMPACT CARD STYLES ========== */
.offer-card, .category-card, .product-card {
	background: #eaedef;;
	border-radius: 15px;
	padding: 12px 10px !important;
	text-align: center;
	box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
	transition: all 0.3s ease;
	position: relative;
	min-width: 160px !important;
	flex-shrink: 0;
	border: 1px solid rgba(0, 0, 0, 0.05);
	overflow: hidden;
	scroll-snap-align: start;
}

.offer-card::before, .category-card::before, .product-card::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 4px;
	background: linear-gradient(135deg, var(--primary) 0%, var(--secondary)
		100%);
}

/* ========== COMPACT IMAGES ========== */
.offer-img {
	height: 90px !important;
	width: 100%;
	object-fit: contain;
	margin-bottom: 8px !important;
	transition: transform 0.3s ease;
	padding: 5px;
}

.category-img {
	height: 80px !important;
	width: 100%;
	object-fit: contain;
	margin-bottom: 8px !important;
	transition: transform 0.3s ease;
	padding: 5px;
}

.product-img {
	height: 100px !important;
	width: 100%;
	object-fit: contain;
	margin-bottom: 8px !important;
	transition: transform 0.3s ease;
	padding: 5px;
}

/* ========== COMPACT DISCOUNT BADGE ========== */
.discount-badge {
	position: absolute;
	top: 8px !important;
	right: 8px !important;
	background: linear-gradient(135deg, var(--accent) 0%, #ff8a9e 100%);
	color: white;
	font-size: 9px !important;
	font-weight: 700;
	padding: 3px 6px !important;
	border-radius: 10px;
	z-index: 2;
	box-shadow: 0 4px 10px rgba(255, 107, 139, 0.3);
}

/* ========== COMPACT CARD TEXT ========== */
.offer-card p.mt-2.fw-bold, .category-card p.mt-2.fw-bold, .product-card p.mt-2.fw-bold
	{
	font-size: 0.8rem !important;
	font-weight: 700;
	color: #2a2d3b !important;
	margin: 6px 0 !important;
	min-height: 32px !important;
	display: flex;
	align-items: center;
	justify-content: center;
	line-height: 1.2;
	padding: 0 3px !important;
}

/* ========== COMPACT PRICE INFO LAYOUT ========== */
.offer-card div, .product-card div.mb-2 {
	margin: 5px 0 !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	flex-wrap: nowrap !important;
	gap: 4px !important;
	font-size: 0.9rem !important;
}

.text-danger.fw-bold {
	font-size: 0.9rem !important;
	font-weight: 800;
	color: #dc3545 !important;
}

.text-decoration-line-through.text-muted.ms-1 {
	font-size: 0.7rem !important;
	color: #6c757d !important;
	opacity: 0.7;
	margin-left: 0 !important;
}

.text-success.ms-1.fw-bold {
	font-size: 0.65rem !important;
	font-weight: 700;
	color: #28a745 !important;
	background: rgba(40, 167, 69, 0.1);
	padding: 1px 4px !important;
	border-radius: 8px;
	margin-left: 0 !important;
}

/* ========== COMPACT STOCK INFO ========== */
.product-stock {
	font-size: 0.7rem !important;
	color: var(--text);
	margin-bottom: -0.5px !important;
	display: block;
}

/* ========== COMPACT ADD BUTTON ========== */
.btn-addcart {
	padding: 8px 10px !important;
	border-radius: 10px;
	background: linear-gradient(135deg, var(--primary) 0%, var(--secondary)
		100%);
	border: none;
	color: white !important;
	font-weight: 700;
	transition: all 0.3s ease;
	font-size: 0.75rem !important;
	box-shadow: 0 5px 15px rgba(74, 108, 247, 0.2);
	display: inline-flex;
	align-items: center;
	justify-content: center;
	gap: 5px !important;
	margin-top: 8px !important;
	width: 100%;
	cursor: pointer;
	min-height: 36px !important;
}

.btn-addcart:hover {
	background: linear-gradient(135deg, #3a5ce5 0%, #5b52e6 100%);
	transform: translateY(-2px);
	box-shadow: 0 8px 20px rgba(74, 108, 247, 0.3);
	color: white !important;
}

/* ========== COMPACT QUANTITY SELECTOR ========== */
.qty-selector {
	display: flex;
	justify-content: center;
	align-items: center;
	gap: 8px !important;
	margin: 8px 0 !important;
	padding: 0 5px;
}

.qty-selector button {
	width: 28px !important;
	height: 28px !important;
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: bold;
	font-size: 0.9rem !important;
	border-radius: 50%;
	border: 2px solid #e2e8f0;
	background: white;
	color: var(--dark);
	cursor: pointer;
	transition: all 0.3s ease;
	box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
	min-height: 32px !important;
	min-width: 32px !important;
}

.qty-selector button:hover {
	background: var(--primary);
	color: white;
	border-color: var(--primary);
	transform: scale(1.05);
}

.qty-selector input {
	width: 40px !important;
	text-align: center;
	border: 2px solid #e2e8f0;
	border-radius: 8px;
	padding: 6px 4px !important;
	font-weight: 700;
	font-size: 0.8rem !important;
	color: var(--dark);
	background: white;
	transition: all 0.3s ease;
}

.qty-selector input:focus {
	border-color: var(--primary);
	box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
	outline: none;
}

/* ========== COMPACT VERTICAL PRODUCT GRID ========== */
.product-grid {
	display: grid;
	grid-template-columns: repeat(2, 1fr);
	gap: 12px !important;
	padding: 10px 0;
}

.product-card-grid {
	background: #eaedef;
	border-radius: 15px;
	padding: 12px 10px !important;
	text-align: center;
	box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
	transition: all 0.3s ease;
	position: relative;
	border: 1px solid rgba(0, 0, 0, 0.05);
	overflow: hidden;
	display: flex;
	flex-direction: column;
	height: 100%;
}

.product-card-grid::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 4px;
	background: linear-gradient(135deg, var(--primary) 0%, var(--secondary)
		100%);
}

.product-card-grid .product-img {
	height: 100px !important;
	width: 100%;
	object-fit: contain;
	margin-bottom: 8px !important;
	transition: transform 0.3s ease;
	padding: 5px;
}

.product-card-grid p.mt-2.fw-bold {
	font-size: 0.75rem !important;
	font-weight: 700;
	color: #2a2d3b !important;
	margin: 5px 0 !important;
	min-height: 30px !important;
	display: flex;
	align-items: center;
	justify-content: center;
	line-height: 1.1;
	padding: 0 3px !important;
}

.product-card-grid .qty-selector {
	margin: -2px 0 !important;
	padding: 0;
}

.product-card-grid .qty-selector input {
	width: 35px !important;
}

.product-card-grid .btn-addcart {
	margin-top: auto;
	padding: 8px 10px !important;
	font-size: 0.7rem !important;
	min-height: 32px !important;
}

/* ========== COMPACT CATEGORIES GRID ========== */
.row.g-4 {
	margin: 0 -6px;
	width: calc(100% + 12px);
}

.col-6.col-md-4.col-lg-2 {
	padding: 5px !important;
}

.category-card {
	height: 100%;
	min-height: 120px !important;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
}

.category-card a.text-dark.text-decoration-none {
	color: #2a2d3b !important;
	font-size: 0.8rem !important;
	transition: color 0.3s ease;
	text-decoration: none !important;
	font-weight: 600;
	text-align: center;
}

.category-card a.text-dark.text-decoration-none:hover {
	color: var(--primary) !important;
}

/* ========== COMPACT PRODUCT LINK ========== */
.product-card a.text-dark.text-decoration-none, .product-card-grid a.text-dark.text-decoration-none
	{
	color: #2a2d3b !important;
	text-decoration: none !important;
	transition: color 0.3s ease;
	display: block;
	margin-bottom: 4px !important;
	font-size: 1.rem !important;
	font-weight: 500;
}

.product-card a.text-dark.text-decoration-none:hover, .product-card-grid a.text-dark.text-decoration-none:hover
	{
	color: var(--primary) !important;
}

/* ========== MOBILE SCROLL HINT ========== */
.scroll-hint {
	text-align: center;
	color: var(--text);
	font-size: 0.75rem;
	margin-top: 10px;
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 8px;
	opacity: 0.8;
	padding: 0 10px;
}

.scroll-hint i {
	color: var(--primary);
	animation: bounce 2s infinite;
}

@
keyframes bounce { 0%, 20%, 50%, 80%, 100% {
	transform: translateX(0);
}

40
%
{
transform
:
translateX(
-6px
);
}
60
%
{
transform
:
translateX(
-3px
);
}
}

/* ========== MOBILE FLOATING CART BUTTON ========== */
.mobile-cart-float {
	position: fixed;
	bottom: 20px;
	right: 20px;
	width: 60px;
	height: 60px;
	background: linear-gradient(135deg, var(--primary) 0%, var(--secondary)
		100%);
	border-radius: 50%;
	display: none;
	align-items: center;
	justify-content: center;
	color: white;
	font-size: 1.5rem;
	box-shadow: 0 10px 25px rgba(74, 108, 247, 0.4);
	z-index: 999;
	cursor: pointer;
	border: 3px solid white;
	animation: float 3s ease-in-out infinite;
}

.mobile-cart-count {
	position: absolute;
	top: -5px;
	right: -5px;
	background: var(--accent);
	color: white;
	font-size: 0.8rem;
	font-weight: bold;
	width: 24px;
	height: 24px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	border: 2px solid white;
}

@
keyframes float { 0%, 100% {
	transform: translateY(0);
}

50
%
{
transform
:
translateY(
-8px
);
}
}

/* ========== MOBILE NOTIFICATION ========== */
.mobile-notification {
	position: fixed;
	bottom: 80px;
	left: 50%;
	transform: translateX(-50%);
	background: rgba(0, 0, 0, 0.85);
	color: white;
	padding: 14px 20px;
	border-radius: 15px;
	z-index: 10000;
	display: flex;
	align-items: center;
	gap: 12px;
	max-width: 90%;
	backdrop-filter: blur(10px);
	-webkit-backdrop-filter: blur(10px);
	border: 1px solid rgba(255, 255, 255, 0.1);
	animation: slideUp 0.3s ease;
}

.mobile-notification i {
	color: var(--warning);
	font-size: 1.3rem;
}

@
keyframes slideUp {from { bottom:60px;
	opacity: 0;
}

to {
	bottom: 80px;
	opacity: 1;
}

}

/* ========== TABLET OPTIMIZATIONS ========== */
@media ( min-width : 768px) {
	html {
		font-size: 17px;
	}
	.fresh-hero {
		height: 350px;
		border-radius: 0 0 25px 25px;
		margin-bottom: 25px;
	}
	.fresh-content {
		padding: 25px 30px;
		max-width: 500px;
	}
	.fresh-content h1 {
		font-size: 2rem;
	}
	.fresh-content p {
		font-size: 1rem;
	}
	.fresh-btn {
		padding: 14px 30px;
		font-size: 1rem;
	}
	.main-container {
		width: 92%;
		padding: 20px;
		margin: 0 auto 30px;
		border-radius: 25px;
	}
	.section-title {
		font-size: 1.6rem;
		margin-bottom: 25px;
	}
	.offer-row {
		gap: 15px;
		padding: 15px 10px;
	}
	.offer-card {
		min-width: 180px !important;
		padding: 15px 12px !important;
	}
	.offer-img {
		height: 110px !important;
	}
	.category-img {
		height: 100px !important;
	}
	.product-img {
		height: 120px !important;
	}
	.btn-addcart {
		padding: 10px 15px !important;
		font-size: 0.8rem !important;
	}
	.col-6.col-md-4.col-lg-2 {
		padding: 8px;
	}
	.category-card {
		min-height: 140px !important;
	}
	.product-grid {
		grid-template-columns: repeat(3, 1fr);
		gap: 15px !important;
	}
	.product-card-grid .product-img {
		height: 120px !important;
	}
	.product-card-grid p.mt-2.fw-bold {
		font-size: 0.8rem !important;
	}
	
	/* Hide mobile floating cart on tablet */
	.mobile-cart-float {
		display: none !important;
	}
}

/* ========== DESKTOP OPTIMIZATIONS ========== */
@media ( min-width : 992px) {
	html {
		font-size: 18px;
	}
	.fresh-hero {
		height: 400px;
		border-radius: 0 0 30px 30px;
		margin-bottom: 30px;
	}
	.fresh-content {
		padding: 30px 40px;
		max-width: 600px;
	}
	.fresh-content h1 {
		font-size: 2.5rem;
	}
	.fresh-content p {
		font-size: 1.1rem;
	}
	.main-container {
		max-width: 1400px;
		padding: 30px;
		margin: 0 auto 40px;
		border-radius: 30px;
	}
	.section-title {
		font-size: 2rem;
		margin-bottom: 30px;
	}
	.offer-row {
		gap: 20px;
		padding: 20px 15px;
	}
	.offer-card {
		min-width: 200px !important;
		padding: 18px 15px !important;
	}
	.offer-img {
		height: 130px !important;
	}
	.category-img {
		height: 110px !important;
	}
	.product-img {
		height: 140px !important;
	}
	.btn-addcart {
		padding: 12px 20px !important;
		font-size: 0.9rem !important;
	}
	.category-card {
		min-height: 150px !important;
	}
	.product-grid {
		grid-template-columns: repeat(4, 1fr);
		gap: 20px !important;
	}
	.product-card-grid .product-img {
		height: 130px !important;
	}
	.product-card-grid p.mt-2.fw-bold {
		font-size: 0.85rem !important;
	}

	/* Show hover effects on desktop */
	.offer-card:hover, .category-card:hover, .product-card:hover,
		.product-card-grid:hover {
		transform: translateY(-8px);
		box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
	}
	.offer-card:hover .offer-img, .category-card:hover .category-img,
		.product-card:hover .product-img, .product-card-grid:hover .product-img
		{
		transform: scale(1.05);
	}
}

/* ========== LARGE DESKTOP ========== */
@media ( min-width : 1200px) {
	.main-container {
		max-width: 1600px;
		padding: 40px;
	}
	.offer-card {
		min-width: 220px !important;
	}
	.product-grid {
		grid-template-columns: repeat(5, 1fr);
		gap: 20px !important;
	}
}

/* ========== MOBILE TOUCH OPTIMIZATIONS ========== */
@media ( hover : none) and (pointer: coarse) {
	.btn-addcart:hover, .fresh-btn:hover, .qty-selector button:hover {
		transform: none !important;
	}
	.btn-addcart:active, .fresh-btn:active, .qty-selector button:active {
		transform: scale(0.95) !important;
		opacity: 0.9;
	}
}

/* ========== UTILITY CLASSES ========== */
.container-fluid {
	padding-left: 15px;
	padding-right: 15px;
}

.row {
	margin-left: -8px;
	margin-right: -8px;
}

@media ( min-width : 768px) {
	.row {
		margin-left: -12px;
		margin-right: -12px;
	}
}

@media ( min-width : 992px) {
	.row {
		margin-left: -15px;
		margin-right: -15px;
	}
}

/* ========== FIX FOR MOBILE HEADER SPACE ========== */
@media ( max-width : 768px) {
	body {
		padding-top: 60px;
	}
}

/* ========== DARK MODE SUPPORT ========== */
@media ( prefers-color-scheme : dark) {
	body {
		background: linear-gradient(135deg, #121212 0%, #1e1e1e 100%);
		color: #e0e0e0;
	}
	.main-container {
		background: #1e1e1e;
		border-color: #333;
	}
	.offer-card, .category-card, .product-card, .product-card-grid {
		background: #2a2a2a;
		border-color: #333;
	}
	.text-dark {
		color: #e0e0e0 !important;
	}
	.text-muted {
		color: #999 !important;
	}
	.qty-selector input, .qty-selector button {
		background: #333;
		border-color: #444;
		color: #e0e0e0;
	}
}
/* ================= IMAGE FIX (FINAL OVERRIDE) ================= */

/* Mobile */
.product-card-grid .product-img {
    height: 130px !important;
    width: 100% !important;
    object-fit: contain;
    padding: 8px;
}

/* Tablet */
@media (min-width: 768px) {
    .product-card-grid .product-img {
        height: 190px !important;
    }
}

/* Desktop */
@media (min-width: 992px) {
    .product-card-grid .product-img {
        height: 220px !important;
    }
}

/* Large Desktop */
@media (min-width: 1200px) {
    .product-card-grid .product-img {
        height: 240px !important;
    }
}

</style>
</head>

<body>
	<%@ include file="header1.jsp"%>

	<!-- Mobile Floating Cart Button -->
	<div class="mobile-cart-float" id="mobileCartButton"
		onclick="openMobileCart()">
		<i class="fas fa-shopping-cart"></i> <span class="mobile-cart-count"
			id="mobileCartCount">0</span>
	</div>

	<!-- ========== HERO SECTION ========== -->
	<section class="fresh-hero">
		<img src="${pageContext.request.contextPath}/assets/kisan.jpg"
			alt="Fresh Produce" class="fresh-hero-image">
		<div class="fresh-content">
			<h1>FreshpickKart – Freshness Delivered</h1>
			<p>Vegetables, fruits, dairy, snacks & more with premium quality.</p>
			<a href="#" class="fresh-btn">Shop Now</a>
		</div>
	</section>

	<div class="main-container">
		<!-- ========== OFFERS ========== -->
		<div class="bg-section">
			<h2 class="section-title">Top Offers</h2>
			<div class="offer-row">
				<c:forEach var="o" items="${offerProducts}">
					<div class="offer-card mobile-card" data-product-id="${o.id}">
						<c:set var="discountPercent"
							value="${((o.price - o.discountPrice) / o.price) * 100}" />
						<c:set var="discountInt"
							value="${fn:substringBefore(discountPercent, '.')}" />
						<span class="discount-badge">${discountInt}% OFF</span> <img
							src="${pageContext.request.contextPath}/assets/img/product_img/${o.image}"
							class="offer-img" alt="${o.title}">
						<p class="mt-2 fw-bold">${o.title}</p>
						 <p class="product-stock">${o.stockQty} ${o.stockUnit}</p>
						<div class="price-info-compact">
							<span class="text-danger fw-bold">₹${o.discountPrice}</span> <span
								class="text-decoration-line-through text-muted">₹${o.price}</span>
							<%-- <span class="text-success fw-bold">Save ₹${o.price - o.discountPrice}</span> --%>
							<span class="mobile-discount-percent">Save ${p.discount}%</span>
						</div>

						<button class="btn-addcart mt-2"
							onclick="mobileAddToCart(${o.id}, 1)">
							<i class="fas fa-cart-plus"></i> Add to Cart
						</button>
					</div>
				</c:forEach>
			</div>
			<div class="scroll-hint">
				<i class="fas fa-arrow-left"></i> Scroll horizontally for more
				offers <i class="fas fa-arrow-right"></i>
			</div>
		</div>

		<!-- ========== CATEGORIES ========== -->
		<div class="bg-section">
			<h2 class="section-title">Shop by Category</h2>
			<div class="row g-4">
				<c:forEach var="c" items="${categories}">
					<div class="col-6 col-md-4 col-lg-2">
						<div class="category-card mobile-card">
							<img
								src="${pageContext.request.contextPath}/assets/img/category_img/${c.imageName}"
								class="category-img" alt="${c.name}">
							<p class="mt-2 fw-bold">
								<a href="products?categories=${c.name}"
									class="text-dark text-decoration-none">${c.name}</a>
							</p>
						</div>
					</div>
				</c:forEach>
			</div>
		</div>

		<!-- ========== LATEST PRODUCTS ========== -->
		<div class="bg-section">
			<h2 class="section-title">Latest Products</h2>
			<div class="product-grid">
				<c:forEach var="p" items="${products}">
					<div class="product-card-grid mobile-card"
						data-product-id="${p.id}">
						<span class="discount-badge">${p.discount}% OFF</span> <img
							src="${pageContext.request.contextPath}/assets/img/product_img/${p.image}"
							class="product-img" alt="${p.title}">
						<p class="mt-2 fw-bold">
							<a href="${pageContext.request.contextPath}/products?id=${p.id}"
								class="text-dark text-decoration-none">${p.title}</a>
						</p>
						<p class="product-stock">${p.stockQty} ${p.stockUnit}</p>
						<div class="price-info-compact mb-2">
							<span class="text-danger fw-bold">₹${p.discountPrice}</span> <span
								class="text-decoration-line-through text-muted">₹${p.price}</span>
							<%-- <span class="text-success fw-bold">Save ₹${p.price - p.discountPrice}</span> --%>
							<span class="mobile-discount-percent">Save ${p.discount}%</span>
						</div>
						<!-- Mobile Optimized Quantity selector -->
						<div class="qty-selector">
							<button type="button"
								onclick="mobileChangeQty('mobile-qty-${p.id}', -1)">-</button>
							<input type="text" value="0" id="mobile-qty-${p.id}"
								class="mobile-qty-input">
							<button type="button"
								onclick="mobileChangeQty('mobile-qty-${p.id}', 1)">+</button>
						</div>
						<button class="btn-addcart mt-2"
							onclick="mobileAddToCart(${p.id}, document.getElementById('mobile-qty-${p.id}').value)">
							<i class="fas fa-cart-plus"></i> Add to Cart
						</button>
					</div>
				</c:forEach>
			</div>
		</div>
	</div>

	<%@ include file="Footar.jsp"%>

	<script>
const isMobileDevice = () => {
    return window.innerWidth <= 768 || 
           /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
};
// ========== MOBILE DETECTION ==========
/* const isMobileDevice = () => {
    return window.innerWidth <= 768 || 
           /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}; */

// ========== INITIALIZE MOBILE ELEMENTS ==========
document.addEventListener('DOMContentLoaded', function() {
    const IS_MOBILE = isMobileDevice();
    
    // Show/hide mobile floating cart
    const mobileCartButton = document.getElementById('mobileCartButton');
    if (IS_MOBILE && mobileCartButton) {
        mobileCartButton.style.display = 'flex';
        document.body.style.paddingBottom = '80px';
    }
    
    // Initialize touch events for mobile
    if (IS_MOBILE) {
        initMobileTouchEvents();
        loadCartCount();
    }
    
    // Mobile scrolling improvements
    initMobileScrolling();
    
    // Mobile card touch events
    const cards = document.querySelectorAll('.mobile-card');
    cards.forEach(card => {
        card.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
        });
        
        card.addEventListener('touchend', function() {
            this.style.transform = '';
        });
    });
});

// ========== MOBILE TOUCH EVENTS ==========
function initMobileTouchEvents() {
    // Add touch feedback to all buttons
    const touchElements = document.querySelectorAll('.btn-addcart, .fresh-btn, .qty-selector button');
    touchElements.forEach(el => {
        el.addEventListener('touchstart', function() {
            this.style.opacity = '0.8';
            this.style.transform = 'scale(0.95)';
        });
        
        el.addEventListener('touchend', function() {
            this.style.opacity = '';
            this.style.transform = '';
        });
    });
    
    // Prevent zoom on double tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, { passive: false });
}

// ========== MOBILE SCROLLING ==========
function initMobileScrolling() {
    const offerRows = document.querySelectorAll('.offer-row');
    offerRows.forEach(row => {
        let startX;
        let scrollLeft;
        
        // Touch events for mobile
        row.addEventListener('touchstart', (e) => {
            startX = e.touches[0].pageX - row.offsetLeft;
            scrollLeft = row.scrollLeft;
        });
        
        row.addEventListener('touchmove', (e) => {
            if (e.touches.length === 1) {
                const x = e.touches[0].pageX - row.offsetLeft;
                const walk = (x - startX) * 2;
                row.scrollLeft = scrollLeft - walk;
                e.preventDefault();
            }
        });
    });
}

// ========== MOBILE CART FUNCTIONS ==========
function mobileAddToCart(productId, quantity) {
    const IS_MOBILE = isMobileDevice();
    
    if (!quantity || quantity < 1) quantity = 1;
    if (quantity > 99) quantity = 99;
    
    // Show loading state
    const button = event?.target?.closest('button') || event.target;
    if (button) {
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        button.disabled = true;
        
        // Mobile vibration feedback
        if (IS_MOBILE && navigator.vibrate) {
            navigator.vibrate(50);
        }
        
        // Mobile ripple effect
        if (IS_MOBILE) {
            const ripple = document.createElement('span');
            ripple.style.cssText = `
                position: absolute;
                border-radius: 50%;
                background: rgba(255,255,255,0.6);
                transform: scale(0);
                animation: ripple 0.6s linear;
                pointer-events: none;
            `;
            
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size/2;
            const y = event.clientY - rect.top - size/2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            
            button.style.position = 'relative';
            button.style.overflow = 'hidden';
            button.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 600);
        }
    }
    
    // API call
    fetch('${pageContext.request.contextPath}/cart/add', {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Accept": "application/json"
        },
        body: JSON.stringify({
            productId: productId,
            quantity: quantity
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Success feedback
            if (button) {
                button.innerHTML = '<i class="fas fa-check"></i> Added!';
                button.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                
                // Reset button after delay
                setTimeout(() => {
                    if (button) {
                        button.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
                        button.style.background = '';
                        button.disabled = false;
                    }
                }, 1500);
            }
            
            // Show mobile notification
            showMobileNotification('Product added to cart!', 'success');
            
            // Update cart counts
            updateCartCount(data.cartCount || 0);
            updateMobileCartCount(data.cartCount || 0);
            
        } else {
            showMobileNotification('Failed to add item', 'error');
            if (button) {
                button.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
                button.disabled = false;
            }
        }
    })
    .catch(error => {
        console.error("Error:", error);
        showMobileNotification('Network error', 'error');
        if (button) {
            button.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
            button.disabled = false;
        }
    });
}

// ========== MOBILE QUANTITY CHANGE ==========
function mobileChangeQty(inputId, delta) {
    const input = document.getElementById(inputId);
    if (!input) return;
    
    let val = parseInt(input.value) || 0;
    val += delta;
    if (val < 0) val = 0;
    if (val > 99) val = 99;
    input.value = val;
    
    // Mobile vibration
    if (isMobileDevice() && navigator.vibrate) {
        navigator.vibrate(10);
    }
    
    // Visual feedback for mobile
    input.style.transform = 'scale(1.1)';
    input.style.borderColor = 'var(--primary)';
    setTimeout(() => {
        input.style.transform = '';
        input.style.borderColor = '';
    }, 300);
}

// ========== MOBILE NOTIFICATION ==========
function showMobileNotification(message, type = 'success') {
    const IS_MOBILE = isMobileDevice();
    
    // Remove existing notification
    const existing = document.querySelector('.mobile-notification');
    if (existing) existing.remove();
    
    const notification = document.createElement('div');
    notification.className = 'mobile-notification';
    
    const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
    const bgColor = type === 'success' ? 'rgba(40, 167, 69, 0.9)' : 'rgba(220, 53, 69, 0.9)';
    
    notification.innerHTML = `
        <i class="${icon}"></i>
        <span>${message}</span>
    `;
    
    notification.style.background = bgColor;
    
    document.body.appendChild(notification);
    
    // Remove after 2 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(-50%) translateY(20px)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 2000);
}

// ========== CART COUNT UPDATES ==========
function updateCartCount(count) {
    const cartCountEl = document.querySelector('.cart-count');
    if (cartCountEl) {
        cartCountEl.textContent = count;
        // Animation
        cartCountEl.style.transform = 'scale(1.3)';
        setTimeout(() => {
            cartCountEl.style.transform = 'scale(1)';
        }, 300);
    }
}

function updateMobileCartCount(count) {
    const mobileCartCount = document.getElementById('mobileCartCount');
    if (mobileCartCount) {
        mobileCartCount.textContent = count;
        
        // Pulse animation
        mobileCartCount.style.transform = 'scale(1.5)';
        setTimeout(() => {
            mobileCartCount.style.transform = 'scale(1)';
        }, 300);
    }
}

// Load initial cart count
function loadCartCount() {
    fetch('${pageContext.request.contextPath}/cart/count')
        .then(response => response.json())
        .then(data => {
            if (data.count !== undefined) {
                updateCartCount(data.count);
                updateMobileCartCount(data.count);
            }
        })
        .catch(console.error);
}

// ========== OPEN MOBILE CART ==========
function openMobileCart() {
    window.location.href = '${pageContext.request.contextPath}/cart';
    
    // Add button animation
    const cartBtn = document.getElementById('mobileCartButton');
    if (cartBtn) {
        cartBtn.style.transform = 'scale(0.9)';
        setTimeout(() => {
            cartBtn.style.transform = '';
        }, 200);
    }
}

// ========== WINDOW RESIZE HANDLER ==========
window.addEventListener('resize', function() {
    const IS_MOBILE = isMobileDevice();
    const mobileCartButton = document.getElementById('mobileCartButton');
    
    // Show/hide mobile cart button
    if (IS_MOBILE && mobileCartButton) {
        mobileCartButton.style.display = 'flex';
        document.body.style.paddingBottom = '80px';
    } else if (mobileCartButton) {
        mobileCartButton.style.display = 'none';
        document.body.style.paddingBottom = '';
    }
});

// ========== ADD CSS FOR ANIMATIONS ==========
if (!document.querySelector('#mobile-animations')) {
    const style = document.createElement('style');
    style.id = 'mobile-animations';
    style.textContent = `
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
}

// ========== PREVENT ACCIDENTAL ZOOM ==========
document.addEventListener('gesturestart', function(e) {
    e.preventDefault();
});

// ========== EXPOSE FUNCTIONS FOR OTHER PAGES ==========
window.mobileUtils = {
    isMobile: isMobileDevice,
    addToCart: mobileAddToCart,
    updateCartCount: updateCartCount
};
</script>
</body>
</html>